<local:SettingsPageBase
    x:Class="_1809_UWP.Pages.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    xmlns:local="using:WikiViewer.Shared.Uwp.Pages"
    xmlns:models="using:WikiViewer.Core.Models"
    Background="Transparent">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="320"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Grid Grid.Column="0" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="0,0,1,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="52"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid Grid.Row="0" Style="{StaticResource PageTitleBarGridStyle}">
                <TextBlock Text="Wikis" Style="{StaticResource PageTitleBarTextStyle}"/>
            </Grid>

            <ListView x:Name="WikiListViewControl" Grid.Row="1" SelectionChanged="WikiListView_SelectionChanged">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="models:WikiInstance">
                        <StackPanel Orientation="Horizontal" Spacing="12" Padding="8">
                            <FontIcon Glyph="&#xE774;" VerticalAlignment="Center"/>
                            <TextBlock Text="{x:Bind Name}" VerticalAlignment="Center" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                        </StackPanel>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <CommandBar Grid.Row="2" DefaultLabelPosition="Right" Background="Transparent">
                <AppBarButton x:Name="AddWikiButtonControl" Icon="Add" Label="Add Wiki" Click="AddWikiButton_Click"/>
                <AppBarButton x:Name="RemoveWikiButtonControl" Icon="Remove" Label="Remove Wiki" Click="RemoveWikiButton_Click" IsEnabled="False"/>
            </CommandBar>
        </Grid>

        <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto">
            <StackPanel x:Name="DetailPanelControl" Spacing="16" Padding="24" MaxWidth="600" Visibility="Collapsed">

                <TextBlock Text="Wiki Details" Style="{ThemeResource SubtitleTextBlockStyle}"/>
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="12">
                        <TextBox x:Name="WikiNameTextBoxControl" Header="Wiki Name"/>
                        <TextBox x:Name="WikiUrlTextBoxControl" Header="MediaWiki Base URL" PlaceholderText="https://en.wikipedia.org/"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="ScriptPathTextBoxControl" Grid.Column="0" Header="Script Path" Margin="0,0,6,0"/>
                            <TextBox x:Name="ArticlePathTextBoxControl" Grid.Column="1" Header="Article Path" Margin="6,0,0,0"/>
                        </Grid>
                        <Button x:Name="DetectPathsButtonControl" HorizontalAlignment="Left" Click="DetectPathsButton_Click">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <SymbolIcon Symbol="Find"/>
                                <TextBlock Text="Detect Paths"/>
                            </StackPanel>
                        </Button>
                        <TextBlock x:Name="DetectionStatusTextControl" Visibility="Collapsed" TextWrapping="Wrap" Style="{ThemeResource CaptionTextBlockStyle}"/>

                        <ToggleSwitch x:Name="ConnectionMethodToggleSwitchControl" Header="Connection Backend" OnContent="Proxy" OffContent="WebView2"/>

                        <Button x:Name="ApplyWikiChangesButtonControl" Content="Save Wiki Changes" HorizontalAlignment="Stretch" Style="{ThemeResource AccentButtonStyle}" Click="ApplyWikiChangesButton_Click"/>
                    </StackPanel>
                </Border>

                <TextBlock Text="Accounts" Style="{ThemeResource SubtitleTextBlockStyle}" Margin="0,16,0,0"/>
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="12">
                        <ListView x:Name="AccountListViewControl" SelectionMode="None" IsItemClickEnabled="False">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="models:Account">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <muxc:PersonPicture ProfilePicture="/Assets/StoreLogo.png" Width="48" Height="48"/>
                                        <TextBlock Grid.Column="1" Text="{x:Bind Username}" VerticalAlignment="Center" Margin="12,0" Style="{ThemeResource BodyTextBlockStyle}"/>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                        <Button x:Name="AddAccountButtonControl" Content="Add Account for this Wiki" HorizontalAlignment="Stretch" Click="AddAccountButton_Click"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <Grid x:Name="LoadingOverlayControl" Grid.ColumnSpan="2" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}" Visibility="Collapsed">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="12">
                <ProgressRing IsActive="True" Width="60" Height="60"/>
                <TextBlock x:Name="LoadingTextControl" Text="Please wait..."/>
            </StackPanel>
        </Grid>
        <Grid x:Name="VerificationPanelControl" Grid.ColumnSpan="2" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}" Visibility="Collapsed">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <StackPanel Margin="12" Spacing="8">
                <TextBlock Text="Please complete the security check" Style="{ThemeResource TitleTextBlockStyle}"/>
                <TextBlock Text="Detection will continue automatically once you finish." Style="{ThemeResource BodyTextBlockStyle}" TextWrapping="Wrap"/>
            </StackPanel>
            <muxc:WebView2 x:Name="VerificationWebView" Grid.Row="1" />
        </Grid>
    </Grid>
</local:SettingsPageBase>
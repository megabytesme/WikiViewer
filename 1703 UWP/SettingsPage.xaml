<local:SettingsPageBase
    x:Class="_1703_UWP.Pages.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:WikiViewer.Shared.Uwp.Pages"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid>
        <ScrollViewer>
            <StackPanel Padding="24,72,24,24" HorizontalAlignment="Center" MaxWidth="520" Margin="16">
                <Border BorderThickness="1" BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}" Padding="16" Margin="0,0,0,16">
                    <StackPanel Margin="12" HorizontalAlignment="Center" MaxWidth="500">
                        <TextBlock Text="Account"
                                   Style="{ThemeResource SubtitleTextBlockStyle}"
                                   HorizontalAlignment="Center"
                                   Margin="0,0,0,8"/>
                        <StackPanel x:Name="LoggedInState"
                                    Orientation="Horizontal"
                                    Visibility="Collapsed"
                                    Margin="12,0">
                            <Ellipse Width="64"
                                     Height="64"
                                     Stroke="{ThemeResource SystemControlForegroundBaseLowBrush}"
                                     StrokeThickness="1">
                                <Ellipse.Fill>
                                    <ImageBrush ImageSource="/Assets/StoreLogo.png" Stretch="UniformToFill"/>
                                </Ellipse.Fill>
                            </Ellipse>
                            <StackPanel VerticalAlignment="Center" Margin="8,0,0,0">
                                <TextBlock x:Name="UsernameText"
                                           Text="Username"
                                           Style="{ThemeResource BodyTextBlockStyle}"/>
                                <HyperlinkButton Content="Sign out"
                                                 Click="SignOutButton_Click"
                                                 Padding="0"/>
                            </StackPanel>
                        </StackPanel>
                        <StackPanel x:Name="LoggedOutState"
                                    Visibility="Collapsed"
                                    Margin="4,8,4,0">
                            <TextBlock x:Name="LoggedOutStateTextBlockControl"
                                       Text="You are not signed in."
                                       Style="{ThemeResource BodyTextBlockStyle}"
                                       TextWrapping="Wrap"/>
                            <HyperlinkButton x:Name="SignInLink"
                                            Content="Sign in"
                                            Click="SignInButton_Click"
                                            Padding="0"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <Border BorderThickness="1" BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}" Padding="16" Margin="0,0,0,16">
                    <StackPanel>
                        <TextBlock Text="Wiki Instance" Style="{ThemeResource SubtitleTextBlockStyle}" HorizontalAlignment="Center"/>
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBox x:Name="WikiUrlTextBoxControl"
                                     Header="MediaWiki Base URL"
                                     PlaceholderText="https://en.wikipedia.org/"/>

                            <Button x:Name="DetectButton"
                                    Grid.Column="1"
                                    Click="DetectButton_Click"
                                    VerticalAlignment="Bottom"
                                    Margin="8,0,0,0"
                                    Style="{ThemeResource AccentButtonStyle}">
                                <StackPanel Orientation="Horizontal">
                                    <SymbolIcon Symbol="Find"/>
                                    <TextBlock Text="Detect" Margin="4,0,0,0"/>
                                </StackPanel>
                            </Button>
                        </Grid>
                        <TextBox x:Name="ScriptPathTextBoxControl" Header="Script Path (if any)" Margin="0,0,0,10"/>
                        <TextBox x:Name="ArticlePathTextBoxControl" Header="Article Path (if any)" Margin="0,0,0,10"/>
                        <TextBlock x:Name="DetectionStatusText" Visibility="Collapsed" TextWrapping="Wrap" Style="{ThemeResource CaptionTextBlockStyle}"/>
                        <TextBlock Text="Changing these values will clear all local data (cache, favourites) and log you out."
                                   TextWrapping="Wrap"
                                   Style="{ThemeResource CaptionTextBlockStyle}" Margin="0,0,0,10"/>
                        <Button x:Name="ApplyUrlButton"
                                Content="Apply and Clear Data"
                                Click="ApplyUrlButton_Click"
                                HorizontalAlignment="Stretch"
                                Style="{ThemeResource AccentButtonStyle}"/>
                    </StackPanel>
                </Border>

                <Border BorderThickness="1" BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}" Padding="16" Margin="0,0,0,16">
                    <StackPanel>
                        <TextBlock Text="Connection" Style="{ThemeResource SubtitleTextBlockStyle}" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                        <Grid VerticalAlignment="Center">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" VerticalAlignment="Center" Margin="0,0,12,0">
                                <TextBlock Text="Connection Backend" VerticalAlignment="Center" Style="{ThemeResource BodyTextBlockStyle}"/>
                                <TextBlock Text="Proxy is designed for devices that cannot pass Cloudflare protection. Usage of proxy may result in some wikis being unavailable - It is recommended to use the WebView connection type when possible."
                                           TextWrapping="Wrap"
                                           Style="{ThemeResource CaptionTextBlockStyle}"
                                           Margin="0,4,0,0"/>
                            </StackPanel>
                            <ToggleSwitch x:Name="ConnectionMethodToggle"
                                          Toggled="ConnectionMethodToggle_Toggled"
                                          VerticalAlignment="Top"
                                          HorizontalAlignment="Right"
                                          Margin="0,-10,-30,0"
                                          OnContent="Proxy"
                                          OffContent="WebView"/>
                        </Grid>
                        <Grid Margin="0,20,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Slider x:Name="ConcurrentDownloadsSlider"
                                    Header="Maximum concurrent downloads per page"
                                    StepFrequency="1"
                                    ValueChanged="ConcurrentDownloadsSlider_ValueChanged"
                                    VerticalAlignment="Center"/>
                            <TextBlock x:Name="ConcurrentDownloadsValueText"
                                       Grid.Column="1"
                                       Text="4"
                                       VerticalAlignment="Center"
                                       Margin="8,0,0,0"/>
                        </Grid>
                        <TextBlock x:Name="RamEstimateText"
                                   Style="{ThemeResource CaptionTextBlockStyle}"
                                   Opacity="0.8"
                                   Margin="0,-10,0,0"
                                   Text="Estimated peak background RAM usage: ~500 MB"/>
                    </StackPanel>
                </Border>

                <Border BorderThickness="1" BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}" Padding="16" Margin="0,0,0,16">
                    <StackPanel>
                        <TextBlock Text="Storage" Style="{ThemeResource SubtitleTextBlockStyle}" HorizontalAlignment="Center"/>
                        <Grid VerticalAlignment="Center">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Enable Offline Reading" VerticalAlignment="Center" Style="{ThemeResource BodyTextBlockStyle}"/>
                            <ToggleSwitch x:Name="CachingToggle"
                                          Toggled="CachingToggle_Toggled"
                                          VerticalAlignment="Center"
                                          HorizontalAlignment="Right"
                                          OffContent="Disabled"
                                          OnContent="Enabled"
                                          Margin="0,0,-30,0"/>
                        </Grid>
                        <Grid Margin="0,10,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                <TextBlock Text="Storage Used" Style="{ThemeResource BodyTextBlockStyle}"/>
                                <TextBlock x:Name="CacheSizeText" Text="Calculating..." Style="{ThemeResource CaptionTextBlockStyle}"/>
                            </StackPanel>

                            <Button x:Name="ClearCacheButtonControl"
                                    Grid.Column="1"
                                    Content="Clear Cache"
                                    Click="ClearCacheButton_Click"
                                    VerticalAlignment="Center"
                                    Style="{ThemeResource AccentButtonStyle}"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <Border BorderThickness="1" BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}" Padding="16">
                    <StackPanel>
                        <TextBlock Text="About" Style="{ThemeResource SubtitleTextBlockStyle}" HorizontalAlignment="Center"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="8">
                            <Button Content="About This App" Click="AboutButton_Click" VerticalAlignment="Center" Margin="0,0,5,0"/>
                            <Button Content="Disclaimer" Click="DisclaimerButton_Click" VerticalAlignment="Center"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <Grid Style="{StaticResource PageTitleBarGridStyle}" Background="{ThemeResource SystemControlBackgroundAltHighBrush}" VerticalAlignment="Top">
            <TextBlock Text="Settings" Style="{StaticResource PageTitleBarTextStyle}"/>
        </Grid>

        <Grid x:Name="LoadingOverlay" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}" Visibility="Collapsed">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Margin="12">
                <ProgressRing IsActive="True" Width="60" Height="60"/>
                <TextBlock x:Name="LoadingOverlayText" Text="Please wait..." Style="{ThemeResource BodyTextBlockStyle}" HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>

        <Grid x:Name="VerificationPanel" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}" Visibility="Collapsed">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <StackPanel Margin="16">
                <TextBlock Text="Please complete the security check" Style="{ThemeResource TitleTextBlockStyle}"/>
                <TextBlock Text="Detection will continue automatically once you finish."
                           Style="{ThemeResource BodyTextBlockStyle}"
                           TextWrapping="Wrap"/>
            </StackPanel>
            <WebView x:Name="VerificationWebView" Grid.Row="1"/>
        </Grid>
    </Grid>
</local:SettingsPageBase>

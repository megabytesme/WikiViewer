<local:SettingsPageBase
    x:Class="_1703_UWP.Pages.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:WikiViewer.Shared.Uwp.Pages"
    xmlns:models="using:WikiViewer.Core.Models"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="320"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Master List Panel -->
        <Grid Grid.Column="0" BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}" BorderThickness="0,0,1,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="52"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid Grid.Row="0" Style="{StaticResource PageTitleBarGridStyle}" Background="{ThemeResource SystemControlBackgroundAltHighBrush}">
                <TextBlock Text="Wikis" Style="{StaticResource PageTitleBarTextStyle}"/>
            </Grid>

            <ListView x:Name="WikiListViewControl" Grid.Row="1" SelectionChanged="WikiListView_SelectionChanged">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="models:WikiInstance">
                        <StackPanel Orientation="Horizontal" Padding="8">
                            <SymbolIcon Symbol="Globe" Margin="0,0,12,0" VerticalAlignment="Center"/>
                            <TextBlock Text="{x:Bind Name}" VerticalAlignment="Center" Style="{ThemeResource BodyTextBlockStyle}"/>
                        </StackPanel>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <CommandBar Grid.Row="2" DefaultLabelPosition="Right" Background="Transparent">
                <AppBarButton x:Name="AddWikiButtonControl" Icon="Add" Label="Add Wiki" Click="AddWikiButton_Click"/>
                <AppBarButton x:Name="RemoveWikiButtonControl" Icon="Remove" Label="Remove Wiki" Click="RemoveWikiButton_Click" IsEnabled="False"/>
            </CommandBar>
        </Grid>

        <!-- Detail Panel -->
        <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto">
            <StackPanel x:Name="DetailPanelControl" Padding="24" MaxWidth="600" Visibility="Collapsed">

                <TextBlock Text="Wiki Details" Style="{ThemeResource SubtitleTextBlockStyle}" Margin="0,0,0,8"/>
                <Border BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" Padding="16">
                    <StackPanel>
                        <TextBox x:Name="WikiNameTextBoxControl" Header="Wiki Name" Margin="0,0,0,12"/>
                        <TextBox x:Name="WikiUrlTextBoxControl" Header="MediaWiki Base URL" PlaceholderText="https://en.wikipedia.org/" Margin="0,0,0,12"/>
                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="ScriptPathTextBoxControl" Grid.Column="0" Header="Script Path" Margin="0,0,6,0"/>
                            <TextBox x:Name="ArticlePathTextBoxControl" Grid.Column="1" Header="Article Path" Margin="6,0,0,0"/>
                        </Grid>
                        <Button x:Name="DetectPathsButtonControl" HorizontalAlignment="Left" Click="DetectPathsButton_Click" Margin="0,0,0,12">
                            <StackPanel Orientation="Horizontal">
                                <SymbolIcon Symbol="Find"/>
                                <TextBlock Text="Detect Paths" Margin="8,0,0,0"/>
                            </StackPanel>
                        </Button>
                        <TextBlock x:Name="DetectionStatusTextControl" Visibility="Collapsed" TextWrapping="Wrap" Style="{ThemeResource CaptionTextBlockStyle}" Margin="0,-8,0,12"/>

                        <ToggleSwitch x:Name="ConnectionMethodToggleSwitchControl" Header="Connection Backend" OnContent="Proxy" OffContent="WebView" Margin="0,0,0,12"/>

                        <Button x:Name="ApplyWikiChangesButtonControl" Content="Save Wiki Changes" HorizontalAlignment="Stretch" Style="{ThemeResource AccentButtonStyle}" Click="ApplyWikiChangesButton_Click"/>
                    </StackPanel>
                </Border>

                <TextBlock Text="Accounts" Style="{ThemeResource SubtitleTextBlockStyle}" Margin="0,24,0,8"/>
                <Border BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" Padding="16">
                    <StackPanel>
                        <ListView x:Name="AccountListViewControl" SelectionMode="None" IsItemClickEnabled="False">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="models:Account">
                                    <Grid Height="48">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <Ellipse Width="40" Height="40" Stroke="{ThemeResource SystemControlForegroundBaseLowBrush}" StrokeThickness="1">
                                            <Ellipse.Fill>
                                                <ImageBrush ImageSource="/Assets/StoreLogo.png" Stretch="UniformToFill"/>
                                            </Ellipse.Fill>
                                        </Ellipse>
                                        <TextBlock Grid.Column="1" Text="{x:Bind Username}" VerticalAlignment="Center" Margin="12,0"/>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                        <Button x:Name="AddAccountButtonControl" Content="Add Account for this Wiki" HorizontalAlignment="Stretch" Margin="0,12,0,0" Click="AddAccountButton_Click"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- Loading and Verification Overlays -->
        <Grid x:Name="LoadingOverlayControl" Grid.ColumnSpan="2" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}" Visibility="Collapsed">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressRing IsActive="True" Width="60" Height="60"/>
                <TextBlock x:Name="LoadingTextControl" Text="Please wait..." HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>
        <Grid x:Name="VerificationPanelControl" Grid.ColumnSpan="2" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}" Visibility="Collapsed">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <StackPanel Margin="16">
                <TextBlock Text="Please complete the security check" Style="{ThemeResource TitleTextBlockStyle}"/>
                <TextBlock Text="Detection will continue automatically once you finish." Style="{ThemeResource BodyTextBlockStyle}" TextWrapping="Wrap"/>
            </StackPanel>
            <WebView x:Name="VerificationWebView" Grid.Row="1"/>
        </Grid>
    </Grid>
</local:SettingsPageBase>